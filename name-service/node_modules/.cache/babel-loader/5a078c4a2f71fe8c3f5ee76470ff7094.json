{"ast":null,"code":"/* jshint node: true */\n\"use strict\";\n\nfunction makeArrayFrom(obj) {\n  return Array.prototype.slice.apply(obj);\n}\n\nvar PENDING = \"pending\",\n    RESOLVED = \"resolved\",\n    REJECTED = \"rejected\";\n\nfunction SynchronousPromise(handler) {\n  this.status = PENDING;\n  this._continuations = [];\n  this._parent = null;\n  this._paused = false;\n\n  if (handler) {\n    handler.call(this, this._continueWith.bind(this), this._failWith.bind(this));\n  }\n}\n\nfunction looksLikeAPromise(obj) {\n  return obj && typeof obj.then === \"function\";\n}\n\nfunction passThrough(value) {\n  return value;\n}\n\nSynchronousPromise.prototype = {\n  then: function (nextFn, catchFn) {\n    var next = SynchronousPromise.unresolved()._setParent(this);\n\n    if (this._isRejected()) {\n      if (this._paused) {\n        this._continuations.push({\n          promise: next,\n          nextFn: nextFn,\n          catchFn: catchFn\n        });\n\n        return next;\n      }\n\n      if (catchFn) {\n        try {\n          var catchResult = catchFn(this._error);\n\n          if (looksLikeAPromise(catchResult)) {\n            this._chainPromiseData(catchResult, next);\n\n            return next;\n          } else {\n            return SynchronousPromise.resolve(catchResult)._setParent(this);\n          }\n        } catch (e) {\n          return SynchronousPromise.reject(e)._setParent(this);\n        }\n      }\n\n      return SynchronousPromise.reject(this._error)._setParent(this);\n    }\n\n    this._continuations.push({\n      promise: next,\n      nextFn: nextFn,\n      catchFn: catchFn\n    });\n\n    this._runResolutions();\n\n    return next;\n  },\n  catch: function (handler) {\n    if (this._isResolved()) {\n      return SynchronousPromise.resolve(this._data)._setParent(this);\n    }\n\n    var next = SynchronousPromise.unresolved()._setParent(this);\n\n    this._continuations.push({\n      promise: next,\n      catchFn: handler\n    });\n\n    this._runRejections();\n\n    return next;\n  },\n  finally: function (callback) {\n    var ran = false;\n\n    function runFinally(result, err) {\n      if (!ran) {\n        ran = true;\n\n        if (!callback) {\n          callback = passThrough;\n        }\n\n        var callbackResult = callback(result);\n\n        if (looksLikeAPromise(callbackResult)) {\n          return callbackResult.then(function () {\n            if (err) {\n              throw err;\n            }\n\n            return result;\n          });\n        } else {\n          return result;\n        }\n      }\n    }\n\n    return this.then(function (result) {\n      return runFinally(result);\n    }).catch(function (err) {\n      return runFinally(null, err);\n    });\n  },\n  pause: function () {\n    this._paused = true;\n    return this;\n  },\n  resume: function () {\n    var firstPaused = this._findFirstPaused();\n\n    if (firstPaused) {\n      firstPaused._paused = false;\n\n      firstPaused._runResolutions();\n\n      firstPaused._runRejections();\n    }\n\n    return this;\n  },\n  _findAncestry: function () {\n    return this._continuations.reduce(function (acc, cur) {\n      if (cur.promise) {\n        var node = {\n          promise: cur.promise,\n          children: cur.promise._findAncestry()\n        };\n        acc.push(node);\n      }\n\n      return acc;\n    }, []);\n  },\n  _setParent: function (parent) {\n    if (this._parent) {\n      throw new Error(\"parent already set\");\n    }\n\n    this._parent = parent;\n    return this;\n  },\n  _continueWith: function (data) {\n    var firstPending = this._findFirstPending();\n\n    if (firstPending) {\n      firstPending._data = data;\n\n      firstPending._setResolved();\n    }\n  },\n  _findFirstPending: function () {\n    return this._findFirstAncestor(function (test) {\n      return test._isPending && test._isPending();\n    });\n  },\n  _findFirstPaused: function () {\n    return this._findFirstAncestor(function (test) {\n      return test._paused;\n    });\n  },\n  _findFirstAncestor: function (matching) {\n    var test = this;\n    var result;\n\n    while (test) {\n      if (matching(test)) {\n        result = test;\n      }\n\n      test = test._parent;\n    }\n\n    return result;\n  },\n  _failWith: function (error) {\n    var firstRejected = this._findFirstPending();\n\n    if (firstRejected) {\n      firstRejected._error = error;\n\n      firstRejected._setRejected();\n    }\n  },\n  _takeContinuations: function () {\n    return this._continuations.splice(0, this._continuations.length);\n  },\n  _runRejections: function () {\n    if (this._paused || !this._isRejected()) {\n      return;\n    }\n\n    var error = this._error,\n        continuations = this._takeContinuations(),\n        self = this;\n\n    continuations.forEach(function (cont) {\n      if (cont.catchFn) {\n        try {\n          var catchResult = cont.catchFn(error);\n\n          self._handleUserFunctionResult(catchResult, cont.promise);\n        } catch (e) {\n          cont.promise.reject(e);\n        }\n      } else {\n        cont.promise.reject(error);\n      }\n    });\n  },\n  _runResolutions: function () {\n    if (this._paused || !this._isResolved() || this._isPending()) {\n      return;\n    }\n\n    var continuations = this._takeContinuations();\n\n    if (looksLikeAPromise(this._data)) {\n      return this._handleWhenResolvedDataIsPromise(this._data);\n    }\n\n    var data = this._data;\n    var self = this;\n    continuations.forEach(function (cont) {\n      if (cont.nextFn) {\n        try {\n          var result = cont.nextFn(data);\n\n          self._handleUserFunctionResult(result, cont.promise);\n        } catch (e) {\n          self._handleResolutionError(e, cont);\n        }\n      } else if (cont.promise) {\n        cont.promise.resolve(data);\n      }\n    });\n  },\n  _handleResolutionError: function (e, continuation) {\n    this._setRejected();\n\n    if (continuation.catchFn) {\n      try {\n        continuation.catchFn(e);\n        return;\n      } catch (e2) {\n        e = e2;\n      }\n    }\n\n    if (continuation.promise) {\n      continuation.promise.reject(e);\n    }\n  },\n  _handleWhenResolvedDataIsPromise: function (data) {\n    var self = this;\n    return data.then(function (result) {\n      self._data = result;\n\n      self._runResolutions();\n    }).catch(function (error) {\n      self._error = error;\n\n      self._setRejected();\n\n      self._runRejections();\n    });\n  },\n  _handleUserFunctionResult: function (data, nextSynchronousPromise) {\n    if (looksLikeAPromise(data)) {\n      this._chainPromiseData(data, nextSynchronousPromise);\n    } else {\n      nextSynchronousPromise.resolve(data);\n    }\n  },\n  _chainPromiseData: function (promiseData, nextSynchronousPromise) {\n    promiseData.then(function (newData) {\n      nextSynchronousPromise.resolve(newData);\n    }).catch(function (newError) {\n      nextSynchronousPromise.reject(newError);\n    });\n  },\n  _setResolved: function () {\n    this.status = RESOLVED;\n\n    if (!this._paused) {\n      this._runResolutions();\n    }\n  },\n  _setRejected: function () {\n    this.status = REJECTED;\n\n    if (!this._paused) {\n      this._runRejections();\n    }\n  },\n  _isPending: function () {\n    return this.status === PENDING;\n  },\n  _isResolved: function () {\n    return this.status === RESOLVED;\n  },\n  _isRejected: function () {\n    return this.status === REJECTED;\n  }\n};\n\nSynchronousPromise.resolve = function (result) {\n  return new SynchronousPromise(function (resolve, reject) {\n    if (looksLikeAPromise(result)) {\n      result.then(function (newResult) {\n        resolve(newResult);\n      }).catch(function (error) {\n        reject(error);\n      });\n    } else {\n      resolve(result);\n    }\n  });\n};\n\nSynchronousPromise.reject = function (result) {\n  return new SynchronousPromise(function (resolve, reject) {\n    reject(result);\n  });\n};\n\nSynchronousPromise.unresolved = function () {\n  return new SynchronousPromise(function (resolve, reject) {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n};\n\nSynchronousPromise.all = function () {\n  var args = makeArrayFrom(arguments);\n\n  if (Array.isArray(args[0])) {\n    args = args[0];\n  }\n\n  if (!args.length) {\n    return SynchronousPromise.resolve([]);\n  }\n\n  return new SynchronousPromise(function (resolve, reject) {\n    var allData = [],\n        numResolved = 0,\n        doResolve = function () {\n      if (numResolved === args.length) {\n        resolve(allData);\n      }\n    },\n        rejected = false,\n        doReject = function (err) {\n      if (rejected) {\n        return;\n      }\n\n      rejected = true;\n      reject(err);\n    };\n\n    args.forEach(function (arg, idx) {\n      SynchronousPromise.resolve(arg).then(function (thisResult) {\n        allData[idx] = thisResult;\n        numResolved += 1;\n        doResolve();\n      }).catch(function (err) {\n        doReject(err);\n      });\n    });\n  });\n};\n/* jshint ignore:start */\n\n\nif (Promise === SynchronousPromise) {\n  throw new Error(\"Please use SynchronousPromise.installGlobally() to install globally\");\n}\n\nvar RealPromise = Promise;\n\nSynchronousPromise.installGlobally = function (__awaiter) {\n  if (Promise === SynchronousPromise) {\n    return __awaiter;\n  }\n\n  var result = patchAwaiterIfRequired(__awaiter);\n  Promise = SynchronousPromise;\n  return result;\n};\n\nSynchronousPromise.uninstallGlobally = function () {\n  if (Promise === SynchronousPromise) {\n    Promise = RealPromise;\n  }\n};\n\nfunction patchAwaiterIfRequired(__awaiter) {\n  if (typeof __awaiter === \"undefined\" || __awaiter.__patched) {\n    return __awaiter;\n  }\n\n  var originalAwaiter = __awaiter;\n\n  __awaiter = function () {\n    var Promise = RealPromise;\n    originalAwaiter.apply(this, makeArrayFrom(arguments));\n  };\n\n  __awaiter.__patched = true;\n  return __awaiter;\n}\n/* jshint ignore:end */\n\n\nmodule.exports = {\n  SynchronousPromise: SynchronousPromise\n};","map":{"version":3,"sources":["/home/abefernan/cosmwasm/dApps/node_modules/synchronous-promise/index.js"],"names":["makeArrayFrom","obj","Array","prototype","slice","apply","PENDING","RESOLVED","REJECTED","SynchronousPromise","handler","status","_continuations","_parent","_paused","call","_continueWith","bind","_failWith","looksLikeAPromise","then","passThrough","value","nextFn","catchFn","next","unresolved","_setParent","_isRejected","push","promise","catchResult","_error","_chainPromiseData","resolve","e","reject","_runResolutions","catch","_isResolved","_data","_runRejections","finally","callback","ran","runFinally","result","err","callbackResult","pause","resume","firstPaused","_findFirstPaused","_findAncestry","reduce","acc","cur","node","children","parent","Error","data","firstPending","_findFirstPending","_setResolved","_findFirstAncestor","test","_isPending","matching","error","firstRejected","_setRejected","_takeContinuations","splice","length","continuations","self","forEach","cont","_handleUserFunctionResult","_handleWhenResolvedDataIsPromise","_handleResolutionError","continuation","e2","nextSynchronousPromise","promiseData","newData","newError","newResult","all","args","arguments","isArray","allData","numResolved","doResolve","rejected","doReject","arg","idx","thisResult","Promise","RealPromise","installGlobally","__awaiter","patchAwaiterIfRequired","uninstallGlobally","__patched","originalAwaiter","module","exports"],"mappings":"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","sourcesContent":["/* jshint node: true */\r\n\"use strict\";\r\nfunction makeArrayFrom(obj) {\r\n  return Array.prototype.slice.apply(obj);\r\n}\r\nvar\r\n  PENDING = \"pending\",\r\n  RESOLVED = \"resolved\",\r\n  REJECTED = \"rejected\";\r\n\r\nfunction SynchronousPromise(handler) {\r\n  this.status = PENDING;\r\n  this._continuations = [];\r\n  this._parent = null;\r\n  this._paused = false;\r\n  if (handler) {\r\n    handler.call(\r\n      this,\r\n      this._continueWith.bind(this),\r\n      this._failWith.bind(this)\r\n    );\r\n  }\r\n}\r\n\r\nfunction looksLikeAPromise(obj) {\r\n  return obj && typeof (obj.then) === \"function\";\r\n}\r\n\r\nfunction passThrough(value) {\r\n  return value;\r\n}\r\n\r\nSynchronousPromise.prototype = {\r\n  then: function (nextFn, catchFn) {\r\n    var next = SynchronousPromise.unresolved()._setParent(this);\r\n    if (this._isRejected()) {\r\n      if (this._paused) {\r\n        this._continuations.push({\r\n          promise: next,\r\n          nextFn: nextFn,\r\n          catchFn: catchFn\r\n        });\r\n        return next;\r\n      }\r\n      if (catchFn) {\r\n        try {\r\n          var catchResult = catchFn(this._error);\r\n          if (looksLikeAPromise(catchResult)) {\r\n            this._chainPromiseData(catchResult, next);\r\n            return next;\r\n          } else {\r\n            return SynchronousPromise.resolve(catchResult)._setParent(this);\r\n          }\r\n        } catch (e) {\r\n          return SynchronousPromise.reject(e)._setParent(this);\r\n        }\r\n      }\r\n      return SynchronousPromise.reject(this._error)._setParent(this);\r\n    }\r\n    this._continuations.push({\r\n      promise: next,\r\n      nextFn: nextFn,\r\n      catchFn: catchFn\r\n    });\r\n    this._runResolutions();\r\n    return next;\r\n  },\r\n  catch: function (handler) {\r\n    if (this._isResolved()) {\r\n      return SynchronousPromise.resolve(this._data)._setParent(this);\r\n    }\r\n    var next = SynchronousPromise.unresolved()._setParent(this);\r\n    this._continuations.push({\r\n      promise: next,\r\n      catchFn: handler\r\n    });\r\n    this._runRejections();\r\n    return next;\r\n  },\r\n  finally: function(callback) {\r\n    var ran = false;\r\n    function runFinally(result, err) {\r\n      if (!ran) {\r\n        ran = true;\r\n        if (!callback) {\r\n          callback = passThrough;\r\n        }\r\n        var callbackResult = callback(result);\r\n        if (looksLikeAPromise(callbackResult)) {\r\n          return callbackResult.then(function() {\r\n            if (err) {\r\n              throw err;\r\n            }\r\n            return result;\r\n          });\r\n        } else {\r\n          return result;\r\n        }\r\n      }\r\n    }\r\n    return this\r\n      .then(function(result) {\r\n        return runFinally(result);\r\n      })\r\n      .catch(function(err) {\r\n        return runFinally(null, err);\r\n      });\r\n  },\r\n  pause: function () {\r\n    this._paused = true;\r\n    return this;\r\n  },\r\n  resume: function () {\r\n    var firstPaused = this._findFirstPaused();\r\n    if (firstPaused) {\r\n      firstPaused._paused = false;\r\n      firstPaused._runResolutions();\r\n      firstPaused._runRejections();\r\n    }\r\n    return this;\r\n  },\r\n  _findAncestry: function () {\r\n    return this._continuations.reduce(function (acc, cur) {\r\n      if (cur.promise) {\r\n        var node = {\r\n          promise: cur.promise,\r\n          children: cur.promise._findAncestry()\r\n        };\r\n        acc.push(node);\r\n      }\r\n      return acc;\r\n    }, []);\r\n  },\r\n  _setParent: function (parent) {\r\n    if (this._parent) {\r\n      throw new Error(\"parent already set\");\r\n    }\r\n    this._parent = parent;\r\n    return this;\r\n  },\r\n  _continueWith: function (data) {\r\n    var firstPending = this._findFirstPending();\r\n    if (firstPending) {\r\n      firstPending._data = data;\r\n      firstPending._setResolved();\r\n    }\r\n  },\r\n  _findFirstPending: function () {\r\n    return this._findFirstAncestor(function (test) {\r\n      return test._isPending && test._isPending();\r\n    });\r\n  },\r\n  _findFirstPaused: function () {\r\n    return this._findFirstAncestor(function (test) {\r\n      return test._paused;\r\n    });\r\n  },\r\n  _findFirstAncestor: function (matching) {\r\n    var test = this;\r\n    var result;\r\n    while (test) {\r\n      if (matching(test)) {\r\n        result = test;\r\n      }\r\n      test = test._parent;\r\n    }\r\n    return result;\r\n  },\r\n  _failWith: function (error) {\r\n    var firstRejected = this._findFirstPending();\r\n    if (firstRejected) {\r\n      firstRejected._error = error;\r\n      firstRejected._setRejected();\r\n    }\r\n  },\r\n  _takeContinuations: function () {\r\n    return this._continuations.splice(0, this._continuations.length);\r\n  },\r\n  _runRejections: function () {\r\n    if (this._paused || !this._isRejected()) {\r\n      return;\r\n    }\r\n    var\r\n      error = this._error,\r\n      continuations = this._takeContinuations(),\r\n      self = this;\r\n    continuations.forEach(function (cont) {\r\n      if (cont.catchFn) {\r\n        try {\r\n          var catchResult = cont.catchFn(error);\r\n          self._handleUserFunctionResult(catchResult, cont.promise);\r\n        } catch (e) {\r\n          cont.promise.reject(e);\r\n        }\r\n      } else {\r\n        cont.promise.reject(error);\r\n      }\r\n    });\r\n  },\r\n  _runResolutions: function () {\r\n    if (this._paused || !this._isResolved() || this._isPending()) {\r\n      return;\r\n    }\r\n    var continuations = this._takeContinuations();\r\n    if (looksLikeAPromise(this._data)) {\r\n      return this._handleWhenResolvedDataIsPromise(this._data);\r\n    }\r\n    var data = this._data;\r\n    var self = this;\r\n    continuations.forEach(function (cont) {\r\n      if (cont.nextFn) {\r\n        try {\r\n          var result = cont.nextFn(data);\r\n          self._handleUserFunctionResult(result, cont.promise);\r\n        } catch (e) {\r\n          self._handleResolutionError(e, cont);\r\n        }\r\n      } else if (cont.promise) {\r\n        cont.promise.resolve(data);\r\n      }\r\n    });\r\n  },\r\n  _handleResolutionError: function (e, continuation) {\r\n    this._setRejected();\r\n    if (continuation.catchFn) {\r\n      try {\r\n        continuation.catchFn(e);\r\n        return;\r\n      } catch (e2) {\r\n        e = e2;\r\n      }\r\n    }\r\n    if (continuation.promise) {\r\n      continuation.promise.reject(e);\r\n    }\r\n  },\r\n  _handleWhenResolvedDataIsPromise: function (data) {\r\n    var self = this;\r\n    return data.then(function (result) {\r\n      self._data = result;\r\n      self._runResolutions();\r\n    }).catch(function (error) {\r\n      self._error = error;\r\n      self._setRejected();\r\n      self._runRejections();\r\n    });\r\n  },\r\n  _handleUserFunctionResult: function (data, nextSynchronousPromise) {\r\n    if (looksLikeAPromise(data)) {\r\n      this._chainPromiseData(data, nextSynchronousPromise);\r\n    } else {\r\n      nextSynchronousPromise.resolve(data);\r\n    }\r\n  },\r\n  _chainPromiseData: function (promiseData, nextSynchronousPromise) {\r\n    promiseData.then(function (newData) {\r\n      nextSynchronousPromise.resolve(newData);\r\n    }).catch(function (newError) {\r\n      nextSynchronousPromise.reject(newError);\r\n    });\r\n  },\r\n  _setResolved: function () {\r\n    this.status = RESOLVED;\r\n    if (!this._paused) {\r\n      this._runResolutions();\r\n    }\r\n  },\r\n  _setRejected: function () {\r\n    this.status = REJECTED;\r\n    if (!this._paused) {\r\n      this._runRejections();\r\n    }\r\n  },\r\n  _isPending: function () {\r\n    return this.status === PENDING;\r\n  },\r\n  _isResolved: function () {\r\n    return this.status === RESOLVED;\r\n  },\r\n  _isRejected: function () {\r\n    return this.status === REJECTED;\r\n  }\r\n};\r\n\r\nSynchronousPromise.resolve = function (result) {\r\n  return new SynchronousPromise(function (resolve, reject) {\r\n    if (looksLikeAPromise(result)) {\r\n      result.then(function (newResult) {\r\n        resolve(newResult);\r\n      }).catch(function (error) {\r\n        reject(error);\r\n      });\r\n    } else {\r\n      resolve(result);\r\n    }\r\n  });\r\n};\r\n\r\nSynchronousPromise.reject = function (result) {\r\n  return new SynchronousPromise(function (resolve, reject) {\r\n    reject(result);\r\n  });\r\n};\r\n\r\nSynchronousPromise.unresolved = function () {\r\n  return new SynchronousPromise(function (resolve, reject) {\r\n    this.resolve = resolve;\r\n    this.reject = reject;\r\n  });\r\n};\r\n\r\nSynchronousPromise.all = function () {\r\n  var args = makeArrayFrom(arguments);\r\n  if (Array.isArray(args[0])) {\r\n    args = args[0];\r\n  }\r\n  if (!args.length) {\r\n    return SynchronousPromise.resolve([]);\r\n  }\r\n  return new SynchronousPromise(function (resolve, reject) {\r\n    var\r\n      allData = [],\r\n      numResolved = 0,\r\n      doResolve = function () {\r\n        if (numResolved === args.length) {\r\n          resolve(allData);\r\n        }\r\n      },\r\n      rejected = false,\r\n      doReject = function (err) {\r\n        if (rejected) {\r\n          return;\r\n        }\r\n        rejected = true;\r\n        reject(err);\r\n      };\r\n    args.forEach(function (arg, idx) {\r\n      SynchronousPromise.resolve(arg).then(function (thisResult) {\r\n        allData[idx] = thisResult;\r\n        numResolved += 1;\r\n        doResolve();\r\n      }).catch(function (err) {\r\n        doReject(err);\r\n      });\r\n    });\r\n  });\r\n};\r\n\r\n/* jshint ignore:start */\r\nif (Promise === SynchronousPromise) {\r\n  throw new Error(\"Please use SynchronousPromise.installGlobally() to install globally\");\r\n}\r\nvar RealPromise = Promise;\r\nSynchronousPromise.installGlobally = function(__awaiter) {\r\n  if (Promise === SynchronousPromise) {\r\n    return __awaiter;\r\n  }\r\n  var result = patchAwaiterIfRequired(__awaiter);\r\n  Promise = SynchronousPromise;\r\n  return result;\r\n};\r\n\r\nSynchronousPromise.uninstallGlobally = function() {\r\n  if (Promise === SynchronousPromise) {\r\n    Promise = RealPromise;\r\n  }\r\n};\r\n\r\nfunction patchAwaiterIfRequired(__awaiter) {\r\n  if (typeof(__awaiter) === \"undefined\" || __awaiter.__patched) {\r\n    return __awaiter;\r\n  }\r\n  var originalAwaiter = __awaiter;\r\n  __awaiter = function() {\r\n    var Promise = RealPromise;\r\n    originalAwaiter.apply(this, makeArrayFrom(arguments));\r\n  };\r\n  __awaiter.__patched = true;\r\n  return __awaiter;\r\n}\r\n/* jshint ignore:end */\r\n\r\nmodule.exports = {\r\n  SynchronousPromise: SynchronousPromise\r\n};\r\n"]},"metadata":{},"sourceType":"script"}